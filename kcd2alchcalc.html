<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kingdom Come: Deliverance 2 - Alchemy Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c1810 0%, #1a0f0a 100%);
            color: #f4e4c1;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #d4af37;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            text-align: center;
            color: #b8956a;
            margin-bottom: 30px;
            font-style: italic;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(60, 40, 20, 0.6);
            border: 2px solid #8b6914;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        h2 {
            color: #d4af37;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #8b6914;
            padding-bottom: 10px;
        }

        .potion-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 6px;
            background: rgba(40, 25, 10, 0.5);
            border: 1px solid #6b5523;
            border-radius: 4px;
            position: relative;
        }

        .potion-entry:hover {
            background: rgba(50, 30, 15, 0.7);
        }

        .potion-name {
            color: #e8d4a0;
            font-weight: 500;
            cursor: help;
        }

        .potion-tooltip {
            visibility: hidden;
            position: absolute;
            left: 0;
            top: 100%;
            margin-top: 5px;
            background: rgba(20, 15, 10, 0.95);
            color: #f4e4c1;
            padding: 10px 12px;
            border-radius: 5px;
            border: 1px solid #d4af37;
            font-size: 0.9em;
            line-height: 1.4;
            z-index: 1000;
            width: 350px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }

        .potion-tooltip strong {
            color: #d4af37;
            display: block;
            margin-top: 8px;
        }

        .potion-entry:hover .potion-tooltip {
            visibility: visible;
        }

        .potion-entry input {
            width: 70px;
            padding: 6px 8px;
            background: rgba(20, 15, 10, 0.7);
            border: 1px solid #8b6914;
            border-radius: 3px;
            color: #f4e4c1;
            font-size: 0.95em;
            text-align: center;
        }

        .potion-entry input:focus {
            outline: none;
            border-color: #d4af37;
        }

        .materials-list {
            list-style: none;
        }

        .material-item {
            background: rgba(40, 25, 10, 0.5);
            border-left: 3px solid #d4af37;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .material-item.checked {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .material-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .material-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #d4af37;
        }

        .material-name {
            color: #e8d4a0;
            font-weight: bold;
        }

        .material-quantity {
            color: #d4af37;
            font-size: 1.2em;
            font-weight: bold;
        }

        .empty-message {
            text-align: center;
            color: #8b6914;
            font-style: italic;
            padding: 40px 20px;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        button {
            background: linear-gradient(135deg, #8b6914 0%, #6b5523 100%);
            color: #f4e4c1;
            border: 2px solid #d4af37;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        button:hover {
            background: linear-gradient(135deg, #a67c1a 0%, #8b6914 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .recipes-section {
            background: rgba(60, 40, 20, 0.6);
            border: 2px solid #8b6914;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            margin-top: 30px;
            display: none;
        }

        .recipes-section.visible {
            display: block;
        }

        .recipe-card {
            background: rgba(40, 25, 10, 0.5);
            border: 1px solid #6b5523;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .recipe-title {
            color: #d4af37;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
            border-bottom: 1px solid #6b5523;
            padding-bottom: 5px;
        }

        .recipe-ingredients {
            color: #e8d4a0;
            line-height: 1.6;
        }

        .recipe-ingredient {
            padding-left: 15px;
            position: relative;
        }

        .recipe-ingredient:before {
            content: "•";
            position: absolute;
            left: 0;
            color: #d4af37;
        }

        .potion-tracking {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #6b5523;
        }

        .tracking-label {
            color: #d4af37;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }

        .tracking-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .tracking-checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(20, 15, 10, 0.5);
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #6b5523;
        }

        .tracking-checkbox-wrapper.checked {
            background: rgba(139, 105, 20, 0.3);
            border-color: #d4af37;
        }

        .tracking-checkbox-wrapper input {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #d4af37;
        }

        .tracking-checkbox-wrapper label {
            color: #e8d4a0;
            cursor: pointer;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>⚗️ Alchemy Calculator</h1>
        <p class="subtitle">Kingdom Come: Deliverance 2</p>

        <div class="main-content">
            <div class="section">
                <h2>Select Potions</h2>
                <div id="potionsList"></div>
                <div class="button-container">
                    <button onclick="calculateMaterials()">Calculate Materials</button>
                </div>
            </div>

            <div class="section">
                <h2>Required Materials</h2>
                <div id="materialsResult">
                    <p class="empty-message">Enter potion quantities and click "Calculate Materials" to see the shopping list.</p>
                </div>
                <div id="showRecipesButton" style="display: none;">
                    <div class="button-container">
                        <button onclick="showRecipes()">Show Recipe Reference</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="recipesSection" class="recipes-section">
            <h2>Recipe Reference (Alphabetical)</h2>
            <div id="recipesList"></div>
        </div>
    </div>

    <script>
        const potions = {
            "Aesop": {
                "ingredients": {
                    "Spirits": 1,
                    "Belladonna": 1,
                    "Boar's Tusk": 1,
                    "Comfrey": 2
                },
                "steps": [
                    "Add 2 Comfrey to the mortar, grind, and pour into the cauldron",
                    "Add 1 Boar's Tusk to cauldron",
                    "Boil for 2 turns",
                    "Add 1 Belladonna to the mortar, grind, and pour into cauldron",
                    "Prepare phial and distill"
                ],
                "effect": "Increases Horsemanship and houndmaster by 5 and makes it easier to sneak up on animals for 24 hours. <strong>Strong Quality:</strong> Animals take less notice of you and dogs don't bark at you"
            },
            "Aqua Vitalis": {
                "ingredients": {
                    "Water": 1,
                    "Dandelion": 2,
                    "Marigold": 1
                },
                "steps": [
                    "Add 2 Dandelion to cauldron",
                    "Boil for 1 turn",
                    "Add 1 Marigold to the mortar, grind, and pour into the cauldron",
                    "Boil for 2 turns",
                    "Prepare phial and distill"
                ],
                "effect": "Lose 50% less Health and slows bleeding by 50% for 10 minutes. <strong>Henry Quality:</strong> Lose 60% less Health and bleed 60% slower for 15 minutes"
            },
            "Artemisia": {
                "ingredients": {
                    "Spirits": 1,
                    "Sage": 1,
                    "Wormwood": 2
                },
                "steps": [
                    "Add 1 Sage to cauldron",
                    "Boil for 1 turn",
                    "Add 2 Wormwood to mortar, grind, and pour into cauldron",
                    "Boil for 2 turns",
                    "Prepare phial and distill"
                ],
                "effect": "Increases Strength by 4 and both attack and defence cost 25% less Stamina for 15 minutes. <strong>Henry Quality:</strong> Increases Strength by 6 and costs 35% less Stamina"
            },
            "Bane Poison": {
                "ingredients": {
                    "Wine": 1,
                    "Amanita Muscaria": 1,
                    "Belladonna": 2,
                    "Wormwood": 1
                },
                "steps": [
                    "Add 1 Wormwood to cauldron",
                    "Boil for 2 turns",
                    "Add 2 Belladonna to mortar, grind, and pour into cauldron",
                    "Boil for 1 turn using bellows",
                    "Add 1 Amanita Muscaria to cauldron",
                    "Prepare phial and distill"
                ],
                "effect": "Makes running impossible and reduces Health by 110 in 30 seconds (Poison)"
            },
            "Bowman's Brew": {
                "ingredients": {
                    "Spirits": 1,
                    "Eyebright": 2,
                    "St. John's Wort": 1
                },
                "steps": [
                    "Add 2 Eyebright to cauldron",
                    "Boil for 3 turns",
                    "Grind 1 St. John's wort and add to cauldron",
                    "Boil for 1 turn",
                    "Prepare phial and distill"
                ],
                "effect": "Improves bow accuracy and steadiness. Increases bow steadiness and allows aiming for longer periods"
            },
            "Buck's Blood": {
                "ingredients": {
                    "Oil": 1,
                    "Comfrey": 1,
                    "Dandelion": 1,
                    "St. John's Wort": 1
                },
                "steps": [
                    "Grind 1 St. John's wort and add to cauldron",
                    "Add 1 Comfrey to cauldron",
                    "Boil for 1 turn",
                    "Add 1 Dandelion to cauldron and using bellows, boil for 1 turn",
                    "Finally, pour"
                ],
                "effect": "Increases maximum Stamina for a period of time. <strong>Strong Quality:</strong> Increases stamina by 30% and stamina regeneration by 15% for 40 minutes"
            },
            "Chamomile Decoction": {
                "ingredients": {
                    "Wine": 1,
                    "Chamomile": 2,
                    "Sage": 1
                },
                "steps": [
                    "Add 2 Chamomile to cauldron",
                    "Boil for 1 turn",
                    "Grind 1 Sage and add to cauldron",
                    "Finally, pour"
                ],
                "effect": "Cures food poisoning. <strong>Strong Quality:</strong> Energy replenishes faster while sleeping"
            },
            "Cockerel": {
                "ingredients": {
                    "Spirits": 1,
                    "Mint": 2,
                    "Valerian": 1
                },
                "steps": [
                    "Grind 2 Mint and add to cauldron",
                    "Boil for 1 turn",
                    "Add 1 Valerian",
                    "Boil for 2 turns",
                    "Prepare phial and distill"
                ],
                "effect": "Increases energy. <strong>Strong Quality:</strong> Slows tiring"
            },
            "Digestive Potion": {
                "ingredients": {
                    "Water": 1,
                    "Charcoal": 1,
                    "Nettle": 1,
                    "Thisle": 2
                },
                "steps": [
                    "Add 2 Thistle to cauldron",
                    "Boil for 2 turns",
                    "Grind 1 Nettle and add to cauldron",
                    "Boil for 1 turn",
                    "Grind 1 Charcoal and add to cauldron",
                    "Finally, pour"
                ],
                "effect": "Reduces feeling of fullness after food and cures food poisoning. <strong>Strong Quality:</strong> Cures any poisoning and boosts vitality"
            },
            "Dollmaker Poison": {
                "ingredients": {
                    "Spirits": 1,
                    "Herb Paris": 2,
                    "Valerian": 1
                },
                "steps": [
                    "Add 2 Herb Paris to cauldron",
                    "Boil for 3 turns",
                    "Grind 1 Valerian and add to cauldron",
                    "Boil for 1 turn",
                    "Prepare phial and distill"
                ],
                "effect": "Reduces weapon skills and makes running impossible (Poison)"
            },
            "Embrocation": {
                "ingredients": {
                    "Oil": 1,
                    "Boar's Tusk": 1,
                    "Eyebright": 1,
                    "Poppy": 1,
                    "Valerian": 1
                },
                "steps": [
                    "Add 1 Poppy and 1 Valerian to cauldron",
                    "Boil for 2 turns",
                    "Grind 1 Eyebright and add to cauldron",
                    "Add 1 Boar's Tusk",
                    "Boil for 1 turn",
                    "Finally, pour"
                ],
                "effect": "Increases agility. <strong>Strong Quality:</strong> Increases agility by 4 and reduces stamina used by sprinting for 15 minutes"
            },
            "Fever Tonic": {
                "ingredients": {
                    "Wine": 1,
                    "Elderberry Leaves": 1,
                    "Feverfew": 3,
                    "Ginger": 2
                },
                "steps": [
                    "Add 3 Feverfew to cauldron",
                    "Boil for 2 turns",
                    "Grind 1 Elderberry leaves and add to cauldron",
                    "Add 2 Ginger",
                    "Boil for 2 turns",
                    "Prepare phial and distill"
                ],
                "effect": "Cures fever and illness"
            },
            "Fox": {
                "ingredients": {
                    "Oil": 1,
                    "Belladonna": 1,
                    "Charcoal": 1,
                    "Nettle": 1,
                    "St. John's Wort": 1
                },
                "steps": [
                    "Grind 1 St. John's wort and 1 Nettle",
                    "Add to cauldron",
                    "Boil for 2 turns",
                    "Grind 1 Charcoal and add to cauldron",
                    "Add 1 Belladonna",
                    "Boil for 1 turn",
                    "Finally, pour"
                ],
                "effect": "Increases Speech and reading speed. <strong>Strong Quality:</strong> +5 Speech and faster reading for 1 day. <strong>Henry Quality:</strong> +7 Speech, faster reading, and +50% experience gain for 2 days"
            },
            "Hair o' the Dog": {
                "ingredients": {
                    "Water": 1,
                    "Mint": 1,
                    "Sage": 1,
                    "St. John's Wort": 1
                },
                "steps": [
                    "Add 1 Sage and 1 St. John's wort to cauldron",
                    "Boil for 3 turns",
                    "Grind 1 Mint and add to cauldron",
                    "Finally, pour"
                ],
                "effect": "Cures hangover and alcohol effects. <strong>Strong Quality:</strong> Cures hangover immediately"
            },
            "Lead Shot Gunpowder": {
                "ingredients": {
                    "Water": 1,
                    "Charcoal": 1,
                    "Saltpetre": 1,
                    "Sulphur": 1
                },
                "steps": [
                    "Add 1 Charcoal to mortar and grind",
                    "Add 1 Saltpetre and 1 Sulphur to mortar",
                    "Grind together",
                    "Pour into mortar and continue grinding until powder forms"
                ],
                "effect": "Creates gunpowder for firearms (lead shot ammunition)"
            },
            "Lethean Water": {
                "ingredients": {
                    "Spirits": 1,
                    "Belladonna": 1,
                    "Henbane": 1,
                    "Wormwood": 2
                },
                "steps": [
                    "Grind 2 Wormwood and add to cauldron",
                    "Add 1 Belladonna",
                    "Boil for 3 turns",
                    "Add 1 Henbane",
                    "Prepare phial and distill"
                ],
                "effect": "Helps forget traumatic memories and reduces stress"
            },
            "Lion Perfume": {
                "ingredients": {
                    "Spirits": 1,
                    "Mint": 2,
                    "Sage": 2
                },
                "steps": [
                    "Add 2 Sage to cauldron",
                    "Boil for 2 turns",
                    "Grind 2 Mint and add to cauldron",
                    "Finally, pour"
                ],
                "effect": "Strong but short-lasting perfume. Substantially increases Charisma for short periods (Perfume). Note: Reduces charisma if combined with another perfume"
            },
            "Lullaby": {
                "ingredients": {
                    "Oil": 1,
                    "Herb Paris": 1,
                    "Poppy": 1,
                    "Thisle": 1
                },
                "steps": [
                    "Add 1 Poppy to cauldron",
                    "Boil for 1 turn",
                    "Add 1 Thistle",
                    "Boil for 1 turn",
                    "Grind 1 Herb Paris and add to cauldron",
                    "Finally, pour"
                ],
                "effect": "Puts target to sleep (used for drugging)"
            },
            "Marigold Decoction": {
                "ingredients": {
                    "Water": 1,
                    "Marigold": 2,
                    "Nettle": 1
                },
                "steps": [
                    "Add 1 Nettle to cauldron",
                    "Boil for 2 turns",
                    "Grind 2 Marigold and add to cauldron",
                    "Finally, pour"
                ],
                "effect": "Gradually heals part of your health. <strong>Strong Quality:</strong> Heals 40 health over 1 minute and helps against hangover. <strong>Henry Quality:</strong> Heals 60 health"
            },
            "Mintha Perfume": {
                "ingredients": {
                    "Wine": 1,
                    "Dandelion": 3,
                    "Marigold": 1,
                    "Mint": 1
                },
                "steps": [
                    "Grind 3 Dandelion and 1 Mint",
                    "Add to cauldron",
                    "Boil for 2 turns",
                    "Add 1 Marigold to cauldron",
                    "Boil for 1 turn using bellows",
                    "Prepare phial and distill"
                ],
                "effect": "Weak but long-lasting perfume. Slightly increases Charisma for a longer period (Perfume). Note: Reduces charisma if combined with another perfume"
            },
            "Moonshine": {
                "ingredients": {
                    "Spirits": 1,
                    "Mint": 2,
                    "Wormwood": 2
                },
                "steps": [
                    "Add 2 Wormwood to cauldron",
                    "Boil for 2 turns",
                    "Grind 2 Mint and add to cauldron",
                    "Boil for 1 turn",
                    "Prepare phial and distill"
                ],
                "effect": "Strong alcoholic beverage that can be sold or consumed"
            },
            "Nighthawk": {
                "ingredients": {
                    "Water": 1,
                    "Belladonna": 1,
                    "Chamomile": 1,
                    "Eyebright": 2
                },
                "steps": [
                    "Add 1 Chamomile and 2 Eyebright to cauldron",
                    "Boil for 2 turns",
                    "Add 1 Belladonna",
                    "Boil for 1 turn",
                    "Prepare phial and distill"
                ],
                "effect": "Improves visibility at night and in dark places. <strong>Strong Quality:</strong> Energy depletes slower. <strong>Henry Quality:</strong> Energy doesn't deplete at all in darkness"
            },
            "Painkiller Brew": {
                "ingredients": {
                    "Spirits": 1,
                    "Comfrey": 1,
                    "Marigold": 1,
                    "Poppy": 3
                },
                "steps": [
                    "Add 3 Poppy to cauldron",
                    "Boil for 2 turns",
                    "Add 1 Comfrey and 1 Marigold",
                    "Boil for 1 turn using bellows",
                    "Prepare phial and distill"
                ],
                "effect": "Lessens the effects of wounds and reduces the amount by which maximum stamina decreases with health. Helps maintain stamina when injured"
            },
            "Quickfinger": {
                "ingredients": {
                    "Water": 1,
                    "Cobweb": 1,
                    "Eyebright": 2,
                    "Valerian": 2
                },
                "steps": [
                    "Add 1 Cobweb and 2 Eyebright to cauldron",
                    "Boil for 3 turns",
                    "Grind 2 Valerian and add to cauldron",
                    "Boil for 1 turn",
                    "Finally, pour"
                ],
                "effect": "Increases thievery and craftsmanship skills. <strong>Henry Quality:</strong> Increases Craftsmanship and Thievery skills by 8 points for 1 hour"
            },
            "Saviour Schnapps": {
                "ingredients": {
                    "Wine": 1,
                    "Belladonna": 2,
                    "Nettle": 1
                },
                "steps": [
                    "Add 1 Nettle to cauldron",
                    "Boil for 2 turns",
                    "Grind 2 Belladonna and add to cauldron",
                    "Boil for 1 turn",
                    "Finally, pour"
                ],
                "effect": "Allows manual saving of the game. <strong>Strong/Henry Quality:</strong> Also boosts Strength, Vitality, and Agility by 3 for 8 minutes and instantly heals 20 health"
            },
            "Scattershot Powder": {
                "ingredients": {
                    "Water": 1,
                    "Leached Charcoal": 1,
                    "Saltpetre": 1,
                    "Sulphur": 1
                },
                "steps": [
                    "Add 1 Leached Charcoal to mortar and grind",
                    "Add 1 Saltpetre and 1 Sulphur to mortar",
                    "Grind together",
                    "Pour into mortar and continue grinding until powder forms"
                ],
                "effect": "Creates gunpowder for firearms (scattershot ammunition)"
            },
            "Soap": {
                "ingredients": {
                    "Oil": 1,
                    "Charcoal": 1,
                    "Dandelion": 1,
                    "Thistle": 2
                },
                "steps": [
                    "Add 2 Thistle to cauldron",
                    "Boil for 1 turn",
                    "Grind 1 Charcoal and add to cauldron",
                    "Add 1 Dandelion",
                    "Boil for 1 turn",
                    "Finally, pour"
                ],
                "effect": "Improves hygiene and Charisma when used for bathing"
            }
        };

        // Initialize the potion list
        function initializePotionsList() {
            const container = document.getElementById('potionsList');
            
            // Sort potions alphabetically
            const sortedPotions = Object.keys(potions).sort();
            
            for (const name of sortedPotions) {
                const data = potions[name];
                const entry = document.createElement('div');
                entry.className = 'potion-entry';
                
                entry.innerHTML = `
                    <span class="potion-name">
                        ${name}
                        <div class="potion-tooltip">${data.effect}</div>
                    </span>
                    <input type="number" 
                           id="${name.replace(/\s+/g, '_').replace(/'/g, '')}" 
                           min="0" 
                           value="0"
                           onchange="calculateMaterials()">
                `;
                
                container.appendChild(entry);
            }
        }

        // Calculate total materials needed
        function calculateMaterials() {
            const materials = {};
            const baseIngredients = ['Water', 'Wine', 'Oil', 'Spirits']; // Bases, not ingredients
            let hasAnyPotion = false;
            
            // Iterate through all potions
            for (const [potionName, potionData] of Object.entries(potions)) {
                const inputId = potionName.replace(/\s+/g, '_').replace(/'/g, '');
                const quantity = parseInt(document.getElementById(inputId).value) || 0;
                
                if (quantity > 0) {
                    hasAnyPotion = true;
                    
                    // Add ingredients for this potion (excluding bases)
                    for (const [ingredient, amount] of Object.entries(potionData.ingredients)) {
                        if (!baseIngredients.includes(ingredient)) {
                            if (!materials[ingredient]) {
                                materials[ingredient] = 0;
                            }
                            materials[ingredient] += amount * quantity;
                        }
                    }
                }
            }
            
            // Display results
            displayMaterials(materials, hasAnyPotion);
        }

        // Display the materials list
        function displayMaterials(materials, hasAnyPotion) {
            const container = document.getElementById('materialsResult');
            const showRecipesBtn = document.getElementById('showRecipesButton');
            
            if (!hasAnyPotion) {
                container.innerHTML = '<p class="empty-message">Enter potion quantities and click "Calculate Materials" to see the shopping list.</p>';
                showRecipesBtn.style.display = 'none';
                return;
            }
            
            // Sort materials alphabetically
            const sortedMaterials = Object.entries(materials).sort((a, b) => a[0].localeCompare(b[0]));
            
            let html = '<ul class="materials-list">';
            
            for (const [material, quantity] of sortedMaterials) {
                // Remove special characters for IDs
                const safeId = material.replace(/[\s.']/g, '_');
                const checkboxId = `checkbox_${safeId}`;
                html += `
                    <li class="material-item" id="item_${safeId}">
                        <div class="material-left">
                            <input type="checkbox" 
                                   class="material-checkbox" 
                                   id="${checkboxId}"
                                   onchange="toggleMaterialCheck('${safeId}')">
                            <span class="material-name">${material}</span>
                        </div>
                        <span class="material-quantity">×${quantity}</span>
                    </li>
                `;
            }
            
            html += '</ul>';
            container.innerHTML = html;
            showRecipesBtn.style.display = 'block';
        }

        // Toggle checked state for material items
        function toggleMaterialCheck(materialId) {
            const item = document.getElementById(`item_${materialId}`);
            const checkbox = document.getElementById(`checkbox_${materialId}`);
            
            if (checkbox.checked) {
                item.classList.add('checked');
            } else {
                item.classList.remove('checked');
            }
        }

        // Show recipes for selected potions
        function showRecipes() {
            const recipesSection = document.getElementById('recipesSection');
            const recipesList = document.getElementById('recipesList');
            
            // Get selected potions with quantities
            const selectedPotions = [];
            for (const [potionName] of Object.entries(potions)) {
                const inputId = potionName.replace(/\s+/g, '_').replace(/'/g, '');
                const quantity = parseInt(document.getElementById(inputId).value) || 0;
                
                if (quantity > 0) {
                    selectedPotions.push({ name: potionName, quantity: quantity });
                }
            }
            
            if (selectedPotions.length === 0) {
                recipesList.innerHTML = '<p class="empty-message">No potions selected.</p>';
                recipesSection.classList.add('visible');
                return;
            }
            
            // Sort alphabetically by name
            selectedPotions.sort((a, b) => a.name.localeCompare(b.name));
            
            let html = '';
            for (const potion of selectedPotions) {
                const potionData = potions[potion.name];
                const ingredients = Object.entries(potionData.ingredients)
                    .map(([name, qty]) => `<div class="recipe-ingredient">${name} × ${qty}</div>`)
                    .join('');
                
                const steps = potionData.steps
                    .map((step, index) => `<div class="recipe-ingredient">${index + 1}. ${step}</div>`)
                    .join('');
                
                // Create tracking checkboxes
                let trackingCheckboxes = '';
                const safeId = potion.name.replace(/\s+/g, '_').replace(/'/g, '').replace(/:/g, '');
                for (let i = 1; i <= potion.quantity; i++) {
                    trackingCheckboxes += `
                        <div class="tracking-checkbox-wrapper" id="wrapper_${safeId}_${i}">
                            <input type="checkbox" 
                                   id="track_${safeId}_${i}" 
                                   onchange="togglePotionCheck('${safeId}', ${i})">
                            <label for="track_${safeId}_${i}">#${i}</label>
                        </div>
                    `;
                }
                
                html += `
                    <div class="recipe-card">
                        <div class="recipe-title">${potion.name} (×${potion.quantity})</div>
                        <div class="recipe-ingredients">
                            <strong>Ingredients:</strong>
                            ${ingredients}
                            <br><br>
                            <strong>Steps:</strong>
                            ${steps}
                        </div>
                        <div class="potion-tracking">
                            <span class="tracking-label">Crafting Progress:</span>
                            <div class="tracking-checkboxes">
                                ${trackingCheckboxes}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            recipesList.innerHTML = html;
            recipesSection.classList.add('visible');
            
            // Scroll to recipes section
            recipesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Toggle checked state for potion tracking checkboxes
        function togglePotionCheck(potionId, num) {
            const wrapper = document.getElementById(`wrapper_${potionId}_${num}`);
            const checkbox = document.getElementById(`track_${potionId}_${num}`);
            
            if (checkbox.checked) {
                wrapper.classList.add('checked');
            } else {
                wrapper.classList.remove('checked');
            }
        }

        // Initialize on page load
        initializePotionsList();
    </script>
</body>
</html>
