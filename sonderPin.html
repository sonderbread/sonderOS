<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sonderPIN Blueprint Pin Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 20px #00ffff;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px #00ffff; }
            to { text-shadow: 0 0 30px #00ffff, 0 0 40px #00ffff; }
        }

        .promotional-message {
            display: none;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 8px;
            font-size: 14px;
            color: #00ff88;
            animation: promotional-glow 3s ease-in-out infinite alternate;
        }

        .promotional-message.visible {
            display: block;
        }

        .promotional-message a {
            color: #00ffff;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .promotional-message a:hover {
            color: #ffffff;
            text-shadow: 0 0 10px #00ffff;
        }

        @keyframes promotional-glow {
            from { 
                box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
                border-color: rgba(0, 255, 0, 0.3);
            }
            to { 
                box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
                border-color: rgba(0, 255, 0, 0.6);
            }
        }

        .engineers-section {
            background: rgba(0, 100, 100, 0.1);
            border: 1px solid #006666;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .engineers-section h3 {
            color: #00ffff;
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }

        .engineers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .engineer-card {
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
        }

        .engineer-name {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .engineer-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .engineer-checkbox {
            margin-right: 8px;
        }

        .grade-select {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .grade-select:focus {
            outline: none;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
        }

        .engineer-location {
            font-size: 12px;
            color: rgba(0, 255, 255, 0.6);
            margin-top: 5px;
        }

        .blueprints-section {
            background: rgba(0, 100, 100, 0.1);
            border: 1px solid #006666;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .blueprints-section h3 {
            color: #00ffff;
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }

        .category-section {
            margin-bottom: 25px;
        }

        .category-header {
            background: rgba(0, 255, 255, 0.15);
            border: 1px solid rgba(0, 255, 255, 0.4);
            border-radius: 6px;
            padding: 10px 15px;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 16px;
            color: #00ffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .blueprint-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .blueprint-item:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: #00ffff;
        }

        .blueprint-name {
            flex: 1;
            font-weight: bold;
            font-size: 14px;
            color: #00ffff;
        }

        .blueprint-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .engineer-dropdown {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 4px;
            min-width: 200px;
            font-size: 14px;
        }

        .engineer-dropdown:focus {
            outline: none;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.5);
        }

        .engineer-dropdown option {
            background: rgba(0, 0, 0, 0.9);
            color: #00ffff;
        }

        .engineer-dropdown option.assigned {
            background: rgba(255, 0, 0, 0.3);
            color: #ff6666;
        }

        .engineer-dropdown option.unlocked {
            color: #00ff88;
        }

        .engineer-dropdown option.locked {
            color: #888888;
        }

        .assigned-indicator {
            background: #ff4444;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            background: rgba(0, 255, 255, 0.05);
            border-top: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px 10px 0 0;
            font-size: 14px;
            color: rgba(0, 255, 255, 0.8);
            line-height: 1.5;
        }

        .footer.branded {
            display: block;
        }

        .footer:not(.branded) {
            display: none;
        }

        .footer a {
            color: #00ffff;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .footer a:hover {
            color: #ffffff;
            text-shadow: 0 0 10px #00ffff;
        }

        .footer .license-text {
            margin-top: 8px;
            font-size: 12px;
            opacity: 0.7;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
            color: rgba(0, 255, 255, 0.8);
            line-height: 1.5;
        }

        .module-header {
            background: rgba(0, 255, 255, 0.08);
            border: 1px solid rgba(0, 255, 255, 0.25);
            border-radius: 4px;
            padding: 8px 12px;
            margin: 15px 0 8px 0;
            font-weight: bold;
            font-size: 15px;
            color: #00dddd;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .blueprint-item.indent {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>sonderPIN Blueprint Pin Planner</h1>
            <p>Plan Your Pinned Blueprints with Perfect Engineer Assignment</p>
            <div class="promotional-message" id="promotionalMessage">
                This tool brought to you by <strong>F.R.E.I.G.H.T.</strong> Come let us know how you like it! 
                <a href="https://discord.gg/freight" target="_blank">discord.gg/freight</a>
            </div>
        </div>

        <div class="instructions">
            <strong>How to use:</strong><br>
            1. First, set which engineers you've unlocked and to what grade in the "Engineer Status" section at the bottom of the page<br>
            2. Then assign engineers to specific blueprints in the "Blueprint Planning" section<br>
            3. Engineers already assigned will be highlighted in red in other dropdowns<br>
            4. Selecting an already-assigned engineer will move them from their previous assignment<br>
            5. Each engineer can only be assigned to one blueprint at a time
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-value" id="totalBlueprints">0</div>
                <div class="stat-label">Total Blueprints</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="assignedBlueprints">0</div>
                <div class="stat-label">Assigned</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="unlockedEngineers">0</div>
                <div class="stat-label">Unlocked Engineers</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maxGradeEngineers">0</div>
                <div class="stat-label">Max Grade Engineers</div>
            </div>
        </div>

        <!-- Blueprint Planning Section -->
        <div class="blueprints-section">
            <h3>Blueprint Planning - Assign Engineers to Blueprints</h3>
            <div id="blueprintsContainer"></div>
        </div>

        <!-- Engineer Status Section -->
        <div class="engineers-section">
            <h3>Engineer Status - Set Your Unlocked Engineers</h3>
            <div class="engineers-grid" id="engineersGrid"></div>
        </div>

        <div class="footer" id="footer">
            <div>
                Brought to you by <strong>CMDR Sonderbread</strong> of <strong>F.R.E.I.G.H.T.</strong> 
                • <a href="https://discord.gg/freight" target="_blank">discord.gg/freight</a>
            </div>
            <div class="license-text">
                Licensed for free use • Not for hosting or commercial modification without permission
            </div>
        </div>
    </div>

    <script>
        // Engineering data - FIXED with correct engineer information
        const engineers = {
            1: { name: "Felicity Farseer", location: "Farseer Inc | Deciat", region: "Bubble" },
            2: { name: "Juri Ishmaak", location: "Ishmaak Reach | Giryak", region: "Bubble" },
            3: { name: "Colonel Bris Dekker", location: "Dekker's Yard | Sol", region: "Bubble" },
            4: { name: "Zacariah Nemo", location: "Nemo Cyber Party Base | Yoru", region: "Bubble" },
            5: { name: "Elvira Martuuk", location: "Khun | Khun", region: "Bubble" },
            6: { name: "Etienne Dorn", location: "Kramp Drive Yards | Los", region: "Colonia" },
            7: { name: "Chloe Sedesi", location: "Cinder Dock | Shenve", region: "Colonia" },
            8: { name: "Marco Qwent", location: "Qwent Research Base | Sirius", region: "Bubble" },
            9: { name: "Professor Palin", location: "Abel Laboratory | Arque", region: "Bubble" },
            10: { name: "Lori Jameson", location: "Jameson Base | Shinrarta Dezhra", region: "Bubble" },
            11: { name: "Lei Cheung", location: "Trader's Rest | Laksak", region: "Bubble" },
            12: { name: "The Dweller", location: "Black Hide | Wyrd", region: "Bubble" },
            13: { name: "Selene Jean", location: "Prospector's Rest | Kuk", region: "Bubble" },
            14: { name: "Didi Vatermann", location: "Vatermann LLC | Leesti", region: "Bubble" },
            15: { name: "Tod McQuinn", location: "Trophy Camp | Wolf 397", region: "Bubble" },
            16: { name: "Liz Ryder", location: "Demolition Unlimited | Eurybia", region: "Bubble" },
            17: { name: "Hera Tani", location: "The Jet's Hole | Kuwemaki", region: "Bubble" },
            18: { name: "Broo Tarquin", location: "Munshin | Munshin", region: "Bubble" },
            19: { name: "Tiana Fortune", location: "Fortune's Loss | Achenar", region: "Bubble" },
            20: { name: "Mel Brandon", location: "The Brig | Luchtaine", region: "Colonia" },
            21: { name: "Marsha Hicks", location: "The Watchtower | Tir", region: "Colonia" },
            22: { name: "Petra Olmanova", location: "Sanctuary | Asura", region: "Colonia" },
            23: { name: "Ram Tah", location: "Phoenix Base | Meene", region: "Bubble" },
            24: { name: "The Sarge", location: "The Beach | Beta-3 Tucani", region: "Bubble" },
            25: { name: "Bill Turner", location: "Turner Metallics Inc | Alioth", region: "Bubble" }
        };

        // UPDATED: Properly structured blueprint data with Didi Vatermann added
        const blueprintData = {
            "Core Modules": {
                "Frame Shift Drive": {
                    "Increased Range": [
                        {id: 1, grade: 5}, {id: 5, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Faster Boot Sequence": [
                        {id: 1, grade: 5}, {id: 5, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Shielded FSD": [
                        {id: 1, grade: 5}, {id: 5, grade: 5}, {id: 20, grade: 5}  
                    ]
                },
                "Thrusters": {
                    "Dirty Drives": [
                        {id: 7, grade: 5}, {id: 9, grade: 5}
                    ],
                    "Clean Drives": [
                        {id: 7, grade: 5}, {id: 9, grade: 5}
                    ],
                    "Drive Distributors": [
                        {id: 1, grade: 3}
                    ]
                },
                "Power Plant": {
                    "Overcharged": [
                        {id: 8, grade: 4}, {id: 19, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}
                    ],
                    "Low Emissions": [
                        {id: 8, grade: 4}, {id: 19, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}
                    ],
                    "Armoured": [
                        {id: 17, grade: 5}, {id: 19, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}
                    ]
                },
                "Power Distributor": {
                    "Charge Enhanced": [
                        {id: 12, grade: 5}, {id: 19, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}
                    ],
                    "Engine Focused": [
                        {id: 8, grade: 3}, {id: 19, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}
                    ],
                    "High Charge Capacity": [
                        {id: 8, grade: 3}, {id: 19, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}
                    ]
                },
                "Sensors": {
                    "Lightweight": [
                        {id: 1, grade: 5}, {id: 6, grade: 5}, {id: 10, grade: 5}, {id: 16, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ],
                    "Long Range": [
                        {id: 1, grade: 5}, {id: 6, grade: 5}, {id: 10, grade: 5}, {id: 16, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ],
                    "Wide Angle": [
                        {id: 1, grade: 5}, {id: 6, grade: 5}, {id: 10, grade: 5}, {id: 16, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ]
                },
                "Life Support": {
                    "Lightweight": [
                        {id: 1, grade: 3}, {id: 5, grade: 3}, {id: 6, grade: 5}, {id: 10, grade: 4}, {id: 20, grade: 5}, {id: 22, grade: 5}
                    ],
                    "Shielded": [
                        {id: 1, grade: 3}, {id: 5, grade: 3}, {id: 6, grade: 5}, {id: 10, grade: 4}, {id: 20, grade: 5}, {id: 22, grade: 5}
                    ]
                }
            },
            "Defensive Modules": {
                "Shield Generator": {
                    "Reinforced": [
                        {id: 5, grade: 3}, {id: 11, grade: 5}, {id: 14, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Thermal Resistant": [
                        {id: 5, grade: 3}, {id: 11, grade: 5}, {id: 14, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Kinetic Resistant": [
                        {id: 5, grade: 3}, {id: 11, grade: 5}, {id: 14, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Enhanced Low Power": [
                        {id: 5, grade: 3}, {id: 11, grade: 5}, {id: 14, grade: 5}, {id: 20, grade: 5}
                    ]
                },
                "Shield Booster": {
                    "Heavy Duty": [
                        {id: 3, grade: 1}, {id: 11, grade: 3}, {id: 14, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Resistance Augmented": [
                        {id: 11, grade: 3}, {id: 14, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Thermal Resistant": [
                        {id: 3, grade: 1}, {id: 11, grade: 3}, {id: 14, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Kinetic Resistant": [
                        {id: 14, grade: 5}, {id: 20, grade: 5}
                    ]
                },
                "Shield Cell Bank": {
                    "Specialised": [
                        {id: 5, grade: 1}, {id: 10, grade: 3}, {id: 20, grade: 4}
                    ],
                    "Rapid Charge": [
                        {id: 5, grade: 1}, {id: 10, grade: 3}, {id: 20, grade: 4}
                    ]
                },
                "Hull Reinforcement Package": {
                    "Heavy Duty": [
                        {id: 16, grade: 1}, {id: 20, grade: 5}
                    ],
                    "Lightweight": [
                        {id: 16, grade: 1}, {id: 20, grade: 5}
                    ]
                },
                "Armour": {
                    "Heavy Duty": [
                        {id: 16, grade: 1}, {id: 19, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Lightweight": [
                        {id: 13, grade: 5}, {id: 16, grade: 1}, {id: 19, grade: 5}, {id: 20, grade: 5}
                    ]
                }
            },
            "Weapon Hardpoints": {
                "Multi-cannon": {
                    "Overcharged": [
                        {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 24, grade: 5}
                    ],
                    "High Capacity": [
                        {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Efficient": [
                        {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Pulse Laser": {
                    "Efficient": [
                        {id: 18, grade: 5}, {id: 19, grade: 4}, {id: 20, grade: 5}
                    ],
                    "Focused": [
                        {id: 18, grade: 5}, {id: 19, grade: 4}, {id: 20, grade: 5}
                    ],
                    "Long Range": [
                        {id: 18, grade: 5}, {id: 19, grade: 4}, {id: 20, grade: 5}
                    ]
                },
                "Beam Laser": {
                    "Efficient": [
                        {id: 18, grade: 5}, {id: 19, grade: 3}, {id: 20, grade: 5}
                    ],
                    "Focused": [
                        {id: 18, grade: 5}, {id: 19, grade: 3}, {id: 20, grade: 5}
                    ],
                    "Long Range": [
                        {id: 18, grade: 5}, {id: 19, grade: 3}, {id: 20, grade: 5}
                    ]
                },
                "Rail Gun": {
                    "Long Range": [
                        {id: 15, grade: 3}, {id: 20, grade: 5}, {id: 21, grade: 5}, {id: 22, grade: 5}
                    ],
                    "High Capacity": [
                        {id: 15, grade: 3}, {id: 20, grade: 5}, {id: 21, grade: 5}, {id: 22, grade: 5}
                    ],
                    "Short Range": [
                        {id: 15, grade: 3}, {id: 20, grade: 5}, {id: 21, grade: 5}, {id: 22, grade: 5}
                    ]
                },
                "Plasma Accelerator": {
                    "Efficient": [
                        {id: 1, grade: 5}, {id: 6, grade: 5}
                    ],
                    "Focused": [
                        {id: 1, grade: 5}, {id: 6, grade: 5}
                    ],
                    "Overcharged": [
                        {id: 1, grade: 5}, {id: 6, grade: 5}
                    ]
                },
                "Cannon": {
                    "Long Range": [
                        {id: 15, grade: 2}, {id: 21, grade: 5}, {id: 24, grade: 5}
                    ],
                    "High Capacity": [
                        {id: 15, grade: 2}, {id: 21, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Overcharged": [
                        {id: 15, grade: 2}, {id: 21, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Fragment Cannon": {
                    "Double Shot": [
                        {id: 21, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Overcharged": [
                        {id: 21, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Efficient": [
                        {id: 21, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Torpedo Pylon": {
                    "Lightweight": [
                        {id: 16, grade: 5}, {id: 20, grade: 5}
                    ],
                    "Sturdy": [
                        {id: 16, grade: 5}, {id: 20, grade: 5}
                    ]
                }
            },
            "Utility Modules": {
                "Frame Shift Wake Scanner": {
                    "Fast Scan": [
                        {id: 1, grade: 3}, {id: 6, grade: 5}, {id: 10, grade: 3}, {id: 16, grade: 3}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ],
                    "Long Range": [
                        {id: 1, grade: 3}, {id: 6, grade: 5}, {id: 10, grade: 3}, {id: 16, grade: 3}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ],
                    "Wide Angle": [
                        {id: 1, grade: 3}, {id: 6, grade: 5}, {id: 10, grade: 3}, {id: 16, grade: 3}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ]
                },
                "Detailed Surface Scanner": {
                    "Expanded Probe Scanning": [
                        {id: 1, grade: 5}, {id: 6, grade: 5}, {id: 8, grade: 5}, {id: 10, grade: 5}, {id: 16, grade: 5}, {id: 20, grade: 5}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ]
                },
                "Kill Warrant Scanner": {
                    "Fast Scan": [
                        {id: 1, grade: 3}, {id: 6, grade: 5}, {id: 10, grade: 3}, {id: 16, grade: 3}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ],
                    "Long Range": [
                        {id: 1, grade: 3}, {id: 6, grade: 5}, {id: 10, grade: 3}, {id: 16, grade: 3}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ],
                    "Wide Angle": [
                        {id: 1, grade: 3}, {id: 6, grade: 5}, {id: 10, grade: 3}, {id: 16, grade: 3}, {id: 22, grade: 5}, {id: 23, grade: 5}
                    ]
                },
                "Electronic Countermeasure": {
                    "Lightweight": [
                        {id: 20, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Shielded": [
                        {id: 20, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Reinforced": [
                        {id: 20, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Chaff Launcher": {
                    "Lightweight": [
                        {id: 20, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Ammo Capacity": [
                        {id: 20, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Heat Sink Launcher": {
                    "Lightweight": [
                        {id: 8, grade: 3}, {id: 20, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Ammo Capacity": [
                        {id: 8, grade: 3}, {id: 20, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Point Defence": {
                    "Lightweight": [
                        {id: 8, grade: 3}, {id: 20, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Ammo Capacity": [
                        {id: 8, grade: 3}, {id: 20, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ]
                }
            },
            "Optional Modules": {
                "Collector Limpet Controller": {
                    "Lightweight": [
                        {id: 8, grade: 5}, {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Shielded": [
                        {id: 8, grade: 5}, {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Fuel Transfer Limpet Controller": {
                    "Lightweight": [
                        {id: 8, grade: 5}, {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Shielded": [
                        {id: 8, grade: 5}, {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Prospector Limpet Controller": {
                    "Lightweight": [
                        {id: 8, grade: 5}, {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ],
                    "Shielded": [
                        {id: 8, grade: 5}, {id: 15, grade: 5}, {id: 21, grade: 5}, {id: 23, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Fuel Scoop": {
                    "Shielded": [
                        {id: 1, grade: 3}, {id: 10, grade: 4}, {id: 21, grade: 5}, {id: 24, grade: 5}
                    ]
                },
                "Auto Field-Maintenance Unit": {
                    "Shielded": [
                        {id: 1, grade: 3}, {id: 10, grade: 4}, {id: 20, grade: 5}
                    ]
                },
                "Refinery": {
                    "Shielded": [
                        {id: 1, grade: 3}, {id: 10, grade: 4}, {id: 21, grade: 5}, {id: 24, grade: 5}
                    ]
                }
            }
        };

        // Global state
        let engineerStatus = {};
        let blueprintAssignments = {};
        let usageCount = 0;

        // Usage tracking
        function loadUsageCount() {
            const saved = localStorage.getItem('ed_engineering_usage_count');
            usageCount = saved ? parseInt(saved) : 0;
        }

        function incrementUsageCount() {
            usageCount++;
            localStorage.setItem('ed_engineering_usage_count', usageCount.toString());
            
            if (usageCount >= 15) {
                updateBrandingDisplay();
            }
        }

        function updateBrandingDisplay() {
            const promotionalMessage = document.getElementById('promotionalMessage');
            const footer = document.getElementById('footer');
            
            if (usageCount >= 15) {
                if (promotionalMessage) {
                    promotionalMessage.classList.add('visible');
                }
                if (footer) {
                    footer.classList.add('branded');
                }
            }
        }

        // Load/Save state
        function loadEngineerStatus() {
            const saved = localStorage.getItem('ed_engineering_engineers_v2');
            if (saved) {
                engineerStatus = JSON.parse(saved);
            } else {
                // Initialize with all engineers locked
                for (let id in engineers) {
                    engineerStatus[id] = { unlocked: false, grade: 1 };
                }
            }
        }

        function saveEngineerStatus() {
            localStorage.setItem('ed_engineering_engineers_v2', JSON.stringify(engineerStatus));
        }

        function loadBlueprintAssignments() {
            const saved = localStorage.getItem('ed_engineering_assignments_v2');
            if (saved) {
                blueprintAssignments = JSON.parse(saved);
            }
        }

        function saveBlueprintAssignments() {
            localStorage.setItem('ed_engineering_assignments_v2', JSON.stringify(blueprintAssignments));
        }

        // Render engineers section
        function renderEngineers() {
            const grid = document.getElementById('engineersGrid');
            grid.innerHTML = '';

            // Sort engineers alphabetically by first name
            const sortedEngineers = Object.entries(engineers).sort((a, b) => {
                const firstNameA = a[1].name.split(' ')[0];
                const firstNameB = b[1].name.split(' ')[0];
                return firstNameA.localeCompare(firstNameB);
            });

            for (let [id, engineer] of sortedEngineers) {
                const card = document.createElement('div');
                card.className = 'engineer-card';
                card.innerHTML = `
                    <div class="engineer-name">${engineer.name}</div>
                    <div class="engineer-controls">
                        <input type="checkbox" class="engineer-checkbox" 
                               ${engineerStatus[id]?.unlocked ? 'checked' : ''} 
                               onchange="toggleEngineer(${id}, this.checked)">
                        <label>Unlocked to Grade:</label>
                        <select class="grade-select" onchange="setEngineerGrade(${id}, this.value)" 
                                ${!engineerStatus[id]?.unlocked ? 'disabled' : ''}>
                            <option value="1" ${engineerStatus[id]?.grade === 1 ? 'selected' : ''}>G1</option>
                            <option value="2" ${engineerStatus[id]?.grade === 2 ? 'selected' : ''}>G2</option>
                            <option value="3" ${engineerStatus[id]?.grade === 3 ? 'selected' : ''}>G3</option>
                            <option value="4" ${engineerStatus[id]?.grade === 4 ? 'selected' : ''}>G4</option>
                            <option value="5" ${engineerStatus[id]?.grade === 5 ? 'selected' : ''}>G5</option>
                        </select>
                    </div>
                    <div class="engineer-location">${engineer.location} (${engineer.region})</div>
                `;
                grid.appendChild(card);
            }
        }

        function toggleEngineer(engineerId, unlocked) {
            engineerStatus[engineerId].unlocked = unlocked;
            if (!unlocked) {
                engineerStatus[engineerId].grade = 1;
                // Remove assignments for this engineer
                for (let blueprintKey in blueprintAssignments) {
                    if (blueprintAssignments[blueprintKey] === parseInt(engineerId)) {
                        delete blueprintAssignments[blueprintKey];
                    }
                }
                saveBlueprintAssignments();
            }
            saveEngineerStatus();
            renderEngineers();
            renderBlueprints();
            updateStats();
        }

        function setEngineerGrade(engineerId, grade) {
            engineerStatus[engineerId].grade = parseInt(grade);
            saveEngineerStatus();
            renderBlueprints();
            updateStats();
        }

        // Render blueprints section
        function renderBlueprints() {
            const container = document.getElementById('blueprintsContainer');
            container.innerHTML = '';

            try {
                for (let [category, modules] of Object.entries(blueprintData)) {
                    const section = document.createElement('div');
                    section.className = 'category-section';
                    
                    const header = document.createElement('div');
                    header.className = 'category-header';
                    
                    let totalBlueprints = 0;
                    for (let module of Object.values(modules)) {
                        totalBlueprints += Object.keys(module).length;
                    }
                    
                    header.textContent = `${category} (${totalBlueprints} blueprints)`;
                    section.appendChild(header);

                    for (let [moduleName, blueprints] of Object.entries(modules)) {
                        // Add module subheader
                        const moduleHeader = document.createElement('div');
                        moduleHeader.className = 'module-header';
                        moduleHeader.textContent = `${moduleName} (${Object.keys(blueprints).length} blueprints)`;
                        section.appendChild(moduleHeader);

                        // Add individual blueprints
                        for (let [blueprintName, engineerList] of Object.entries(blueprints)) {
                            const blueprintKey = `${moduleName} - ${blueprintName}`;
                            const assignedEngineerId = blueprintAssignments[blueprintKey];
                            
                            const item = document.createElement('div');
                            item.className = 'blueprint-item indent';
                            
                            const assignedIndicator = assignedEngineerId ? 
                                `<div class="assigned-indicator">Assigned to ${engineers[assignedEngineerId].name}</div>` : '';

                            item.innerHTML = `
                                <div class="blueprint-name">${blueprintName}</div>
                                <div class="blueprint-controls">
                                    ${assignedIndicator}
                                    <select class="engineer-dropdown" onchange="assignEngineer('${blueprintKey}', this.value)">
                                        <option value="">Select Engineer...</option>
                                        ${generateEngineerOptions(engineerList, assignedEngineerId)}
                                    </select>
                                </div>
                            `;
                            section.appendChild(item);
                        }
                    }

                    container.appendChild(section);
                }
            } catch (error) {
                console.error('Error rendering blueprints:', error);
                container.innerHTML = '<div style="color: #ff6666; padding: 20px;">Error loading blueprints. Please refresh the page.</div>';
            }
        }

        function generateEngineerOptions(engineerList, currentAssignment) {
            let options = '';
            
            for (let engineerData of engineerList) {
                const engineerId = engineerData.id;
                const maxGrade = engineerData.grade;
                const engineer = engineers[engineerId];
                const status = engineerStatus[engineerId];
                const assignedTo = getEngineerAssignment(engineerId);
                const isCurrentAssignment = currentAssignment === engineerId;
                
                let optionClass = '';
                let gradeText = '';
                let disabled = '';
                
                if (!status?.unlocked) {
                    optionClass = 'locked';
                    gradeText = ' (Not Unlocked)';
                    disabled = 'disabled';
                } else if (assignedTo && !isCurrentAssignment) {
                    optionClass = 'assigned';
                    gradeText = ` (G${Math.min(status.grade, maxGrade)} - ASSIGNED TO ${assignedTo})`;
                } else {
                    optionClass = 'unlocked';
                    gradeText = ` (G${Math.min(status.grade, maxGrade)})`;
                }
                
                const selected = isCurrentAssignment ? 'selected' : '';
                
                options += `<option value="${engineerId}" class="${optionClass}" ${disabled} ${selected}>
                    ${engineer.name}${gradeText}
                </option>`;
            }
            
            return options;
        }

        // Helper function to get what blueprint an engineer is assigned to
        function getEngineerAssignment(engineerId) {
            for (let [blueprintKey, assignedEngineerId] of Object.entries(blueprintAssignments)) {
                if (assignedEngineerId === engineerId) {
                    return blueprintKey; // Returns "Module - Blueprint" format
                }
            }
            return null;
        }

        function assignEngineer(blueprintKey, engineerId) {
            if (!engineerId) {
                // Unassign
                delete blueprintAssignments[blueprintKey];
            } else {
                const targetEngineerId = parseInt(engineerId);
                
                // Check if this engineer is already assigned to another blueprint
                for (let [existingBlueprintKey, existingEngineerId] of Object.entries(blueprintAssignments)) {
                    if (existingEngineerId === targetEngineerId && existingBlueprintKey !== blueprintKey) {
                        // Remove the existing assignment
                        delete blueprintAssignments[existingBlueprintKey];
                        break;
                    }
                }
                
                // Assign to new blueprint
                blueprintAssignments[blueprintKey] = targetEngineerId;
                
                // Increment usage count
                incrementUsageCount();
            }
            
            saveBlueprintAssignments();
            renderBlueprints();
            updateStats();
        }

        // Update statistics
        function updateStats() {
            try {
                let totalBlueprints = 0;
                for (let category of Object.values(blueprintData)) {
                    for (let module of Object.values(category)) {
                        totalBlueprints += Object.keys(module).length;
                    }
                }
                
                const assignedBlueprints = Object.keys(blueprintAssignments).length;
                const unlockedEngineers = Object.values(engineerStatus).filter(status => status.unlocked).length;
                const maxGradeEngineers = Object.values(engineerStatus).filter(status => status.unlocked && status.grade === 5).length;

                document.getElementById('totalBlueprints').textContent = totalBlueprints;
                document.getElementById('assignedBlueprints').textContent = assignedBlueprints;
                document.getElementById('unlockedEngineers').textContent = unlockedEngineers;
                document.getElementById('maxGradeEngineers').textContent = maxGradeEngineers;
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // Initialize the app
        function initializeApp() {
            console.log('Initializing Elite Engineering Planner v2.1 (Fixed)...');
            
            try {
                loadUsageCount();
                loadEngineerStatus();
                loadBlueprintAssignments();
                renderEngineers();
                renderBlueprints();
                updateStats();
                updateBrandingDisplay();
                
                console.log('Initialization complete!');
            } catch (error) {
                console.error('Error during initialization:', error);
                
                // Show error message to user
                const container = document.getElementById('blueprintsContainer');
                if (container) {
                    container.innerHTML = `
                        <div style="color: #ff6666; padding: 20px; background: rgba(255, 0, 0, 0.1); border: 1px solid #ff6666; border-radius: 8px;">
                            <h3>⚠️ Initialization Error</h3>
                            <p>There was an error loading the blueprint data. Please refresh the page.</p>
                            <p><strong>Error:</strong> ${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
